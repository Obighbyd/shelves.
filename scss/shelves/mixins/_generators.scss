// Generates the entire grid, made up of reusable classes for a modular OOCSS
// approach to using the grid. All of the class names can be customized.
//
//   $include-nested-columns - Include nested columns in the default grid.
//                             Defaults to true.
//   $include-mobile-resets  - Include mobile resets (remove grid for mobile
//                             sizes). Defaults to true.
//   $include-mobile-columns - Include mobile columns (special column classes
//                             for mobile sizes). Defaults to true.
//   $include-prefix         - Include prefix classes. Deafults to true.
//   $include-suffix         - Include suffix classes. Deafults to true.
//   $include-push           - Include push classes. Deafults to true.
//   $include-pull           - Include pull classes. Deafults to true.
//   $include-nested-prefix  - Include prefix classes for neseted columns.
//                             Defaults to true.
//   $include-nested-suffix  - Include suffix classes  for neseted columns.
//                             Defaults to true.
//   $include-nested-push    - Include push classes for neseted columns.
//                             Defaults to false.
//   $include-nested-pull    - Include pull classes for neseted columns.
//                             Defaults to false.
//
@mixin shelves(
  $include-nested-columns: true,
  $include-mobile-resets:  true,
  $include-mobile-columns: true,
  $include-prefix:         true,
  $include-suffix:         true,
  $include-push:           true,
  $include-pull:           true,
  $include-nested-prefix:  true,
  $include-nested-suffix:  true,
  $include-nested-push:    false,
  $include-nested-pull:    false
) {
  
  @include shelves-base;
  @include shelves-columns(
    $include-column-gutter: false,
    $include-prefix:        $include-prefix,
    $include-suffix:        $include-suffix,
    $include-push:          $include-push,
    $include-pull:          $include-pull
  );
  
  @if $include-nested-columns == true {
    @for $i from 1 to $shelves-columns - 1  {
      // Loop background through the columns
      // to cascade the nested column properties.
      $i: $shelves-columns - $i;
    
      .#{$shelves-column-name}#{$shelves-separator}#{$i} {
        @include shelves-columns(
          $start:                 1,
          $end:                   $i,
          $context:               $i,
          $include-column-gutter: true,
          $include-prefix:        $include-nested-prefix,
          $include-suffix:        $include-nested-suffix,
          $include-push:          $include-nested-push,
          $include-pull:          $include-nested-pull
        );
      } 
    }
  }
  
  @media screen and (max-width: 767px) {
    @if $include-mobile-resets == true {
      @include shelves-resets;
    }
    @if $include-mobile-columns == true {
      @include shelves-mobile-columns;
    }
  }
}

// Generates the grid's base classes, namely the
// the row and container elements.
@mixin shelves-base {
  .#{$shelves-container-name} {
    @include container;
  }
  
  .#{$shelves-row-name} {
    @include row($min-width: 767px);
  }
  
  [class*="#{$shelves-column-name}#{$shelves-separator}"], {
    @include column-base;
    @include column-gutter($include-first-column: false);
    
    &,
    & [class*="#{$shelves-column-name}#{$shelves-separator}"] {
      &:first-child {
        @include reset-column-gutter;
      }
    }
  }
}

// Generates the classes used for laying out and modifying
// the columns. This can be used in different contexts, varying
// the number of columns if necessary.
//
//   $start                 - Index to start the loop at. Defaults to 1.
//   $end                   - Where to end the loop. Defaults to $shelves-columns.
//   $context               - The context of generated classes.
//                            Defaults to $shelves-columns.
//   $include-column-gutter - Include generic column gutter for the given context.
//                            Defaults to true.
//   $include-prefix        - Include prefix classes. Deafults to true.
//   $include-suffix        - Include suffix classes. Deafults to true.
//   $include-push          - Include push classes. Deafults to true.
//   $include-pull          - Include pull classes. Deafults to true.
//
@mixin shelves-columns(
  $start:                 1,
  $end:                   $shelves-columns,
  $context:               $shelves-columns,
  $include-column-gutter: true,
  $include-prefix:        true,
  $include-suffix:        true,
  $include-push:          true,
  $include-pull:          true
) {
  @if $include-column-gutter {
    [class*="#{$shelves-column-name}#{$shelves-separator}"] {
      @include column-gutter($context, false);
    }
  }

  @for $i from $start to $end  {
    .#{$shelves-column-name}#{$shelves-separator}#{$i} {
      @include columns-width($i, $context);
    }
  }
    
  @if $include-prefix == true {
    @for $i from $start to $end  {
      .#{$shelves-prefix-name}#{$shelves-separator}#{$i} {
        @include column-prefix($i, $context);
      }
    }
  }
    
  @if $include-suffix == true {
    @for $i from $start to $end  {
      .#{$shelves-suffix-name}#{$shelves-separator}#{$i} {
        @include column-suffix($i, $context);
      }
    }
  }
    
  @if $include-push == true {
    @for $i from $start to $end  {
      .#{$shelves-push-name}#{$shelves-separator}#{$i} {
        @include column-push($i, $context);
      }
    }
  }
    
  @if $include-pull == true {
    @for $i from $start to $end  {
      .#{$shelves-pull-name}#{$shelves-separator}#{$i} {
        @include column-pull($i, $context);
      }
    }
  }
}

// Resets the row and column elements so they take up
// the full width of their parent element. All modifying
// effects are removed from columns as well.
@mixin shelves-resets {
  .#{$shelves-row-name} {
    @include reset-row;
  }
  
  [class*="#{$shelves-column-name}#{$shelves-separator}"] {
    &,
    & [class*="#{$shelves-column-name}#{$shelves-separator}"] {
      @include reset-column;
    }
  }
}

// Generates the classes for columns on mobile devices.
@mixin shelves-mobile-columns {
  $base-class: ".#{$shelves-mobile-column-name}#{$shelves-separator}base";
  
  #{$base-class} {
    @include column-base;
    @include column-gutter($include-first-column: false);
  
    &:first-child {
      @include reset-column-gutter;
    }
  }
    
  .#{$shelves-mobile-column-name} {
    $mobile-step: floor($shelves-columns / $shelves-mobile-columns);
    $i: $mobile-step;
    
    @while $i < $shelves-columns {
      &.#{$shelves-column-name}#{$shelves-separator}#{$i} {
        @extend #{$base-class};
        @include columns-width($i);
      }
      
      $i: $i + $mobile-step;
    }
  }
}
